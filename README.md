# Telegram Intelligence Brief Generator (tgn8nnews)

**A specialized n8n workflow for transforming raw Telegram data into executive-level geopolitical intelligence reports.**

This project provides a complete pipeline to ingest news from Telegram channels, clean and filter the noise, and utilize an LLM (Google Gemini) to synthesize a professional HTML intelligence brief. It is designed to run autonomously on a Linux server orchestrated by n8n.

## üöÄ Project Overview

The system automates the role of an intelligence analyst. It takes a raw stream of chaotic Telegram messages and produces a polished, deduplicated, and thematically organized HTML report suitable for email distribution.

**Key Features:**
*   **Automated Ingestion:** Receives raw JSON dumps from Telegram scraper bots.
*   **Intelligent Cleaning:** `process_messages.py` strips emojis, promotional footers, and spam while preserving critical timestamps and content.
*   **LLM Synthesis:** Uses Google Gemini (via CLI) to analyze hundreds of messages, connect dots, and identify strategic trends versus tactical noise.
*   **Professional Output:** Generates a standalone `brief.html` with academic-style citations and modern CSS formatting.

## üõ†Ô∏è Architecture

The workflow is orchestrated by **n8n** and executes the following pipeline on a Linux worker node:

1.  **Trigger:** Scheduled or Webhook-based trigger starts the flow.
2.  **Fetch & Upload:** Retrieves raw messages (`messages.json`) and uploads them to the working directory.
3.  **Process (Python):** 
    *   Parses the JSON.
    *   Cleans text (regex for emojis, links).
    *   Filters irrelevant content (optional).
    *   Formats data for the LLM.
4.  **Prompt Engineering:** Combines the processed data with strict `instructions.txt` to guide the AI's behavior.
5.  **Generation:** Pipes the prompt into the `gemini` CLI tool.
6.  **Delivery:** The resulting `brief.html` is ready for email or web publishing.

## üìÇ File Structure

*   **`TG_News.json`**: The complete n8n workflow definition. Import this directly into n8n.
*   **`process_messages.py`**: The core data processing engine.
    *   *Inputs:* `messages.json`
    *   *Outputs:* `messages_processed.json` (or stdout for piping)
    *   *Logic:* Emoji removal, timestamp parsing, deduplication prep.
*   **`instructions.txt`**: The "System Prompt" for the AI.
    *   Defines the HTML structure/CSS.
    *   Enforces citation styles (e.g., `[Group Name, Time]`).
    *   Sets the tone (active voice, objective analysis).
*   **`cat.sh`** *(Legacy)*: Helper script for prompt concatenation. (Note: Logic is moving toward a unified Python pipeline).
*   **`brief.html`**: The artifact generated by the pipeline.

## ‚öôÔ∏è Setup & Requirements

### Prerequisites
*   **n8n**: Installed and running (self-hosted or cloud).
*   **Linux Server**: The worker node executing the commands.
*   **Python 3**: For running the processing script.
*   **Gemini CLI**: A command-line tool for interacting with Google's Gemini API (assumed to be installed as `gemini` in the path).
*   **Node.js/NVM**: Required if the Gemini tool is a Node package.

### Installation

1.  **Clone the Repo:**
    ```bash
    git clone https://github.com/mclancyfl21/tgn8nnews.git
    cd tgn8nnews
    ```

2.  **Configure the Server:**
    Ensure your n8n worker has access to the directory and the necessary environment variables (API keys for Gemini).

3.  **Import Workflow:**
    *   Open n8n.
    *   Import `TG_News.json`.
    *   Update the **SSH Node** credentials and paths to match your server setup.

## üé® Customization

### Changing the Report Style
Edit `instructions.txt`.
*   **CSS:** Modify the `<style>` block to change fonts, colors, or layout.
*   **Tone:** Adjust the "Content Requirements" to make the report more detailed or more concise.

### Adjusting Filters
Edit `process_messages.py`.
*   **Excluded Terms:** Update the `contains_excluded_content` function to add/remove keywords (e.g., specific regions or topics).
*   **Length Limits:** Adjust the character count threshold to catch shorter breaking news or filter out one-liners.

## ‚ö†Ô∏è Known Dependencies
The current workflow relies on specific shell commands in the n8n "Execute Command" node:
```bash
python3 process_messages.py && bash cat.sh && ... gemini -y < combined_prompt.txt
```
Ensure all paths and permissions are correct for the user running the n8n process.
